(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63371,e=>{"use strict";var t=e.i(43476),a=e.i(71645);let r={"q2:life_of_party:balanced":.5,"q2:balanced:small_gatherings":.5,"q2:small_gatherings:close_friends":.6,"q3:gym_regular:sometimes":.5,"q3:sometimes:casual":.5,"q3:casual:other":.4,"q5:spontaneous:balanced":.5,"q5:balanced:planner":.5,"q5:planner:structured":.6,"q8:outgoing:balanced":.5,"q8:balanced:introverted":.5,"q10:outgoing_partner:balance_partner":.5,"q10:calm_partner:balance_partner":.5};function n(e,t){let a=new Map(e.map(e=>[e.questionId,e.value])),n=0,o=0;for(let e of t){let t=a.get(e.questionId);if(void 0===t)continue;n+=1;let l=Array.isArray(t)?t.sort().join(","):String(t),i=Array.isArray(e.value)?e.value.sort().join(","):String(e.value);if(l===i)o+=1;else{let t=r[`${e.questionId}:${[l,i].sort().join(":")}`];t&&(o+=t)}}return 0===n?75:Math.round(o/n*40+60)}function o(e){return e>=90?"Highly aligned values and vision":e>=80?"Strong alignment on what matters":e>=70?"Meaningful overlap in priorities":e>=60?"Good foundation for connection":"Worth a deeper conversation"}var l=e.i(11795);function i(e){return{id:e.id,name:e.name,age:e.age,gender:e.gender,datingPreference:e.dating_preference??void 0,location:e.location,email:e.email,photoUrl:e.photo_url??void 0,photos:e.photos??void 0,quizSnapshot:e.quiz_snapshot??void 0,createdAt:new Date(e.created_at).getTime()}}let s="ambrosia_user",u="ambrosia_quiz",d="ambrosia_matches",c="ambrosia_conversations",m=(0,a.createContext)(null),p=[{id:"mock-1",name:"Jordan",age:29,gender:"Non-binary",location:"Brooklyn, NY",email:"j@example.com",photoUrl:"https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&h=400&fit=crop",createdAt:Date.now()},{id:"mock-2",name:"Alex",age:31,gender:"Woman",location:"Portland, OR",email:"a@example.com",photoUrl:"https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=400&h=400&fit=crop",createdAt:Date.now()},{id:"mock-3",name:"Sam",age:27,gender:"Man",location:"Austin, TX",email:"s@example.com",photoUrl:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=400&fit=crop",createdAt:Date.now()},{id:"mock-4",name:"Riley",age:33,gender:"Woman",location:"Seattle, WA",email:"r@example.com",photoUrl:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=400&fit=crop",createdAt:Date.now()},{id:"mock-5",name:"Morgan",age:30,gender:"Man",location:"Denver, CO",email:"m@example.com",photoUrl:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=400&h=400&fit=crop",createdAt:Date.now()}];function g(e,t){try{let a=localStorage.getItem(e);return a?JSON.parse(a):t}catch{return t}}function h(e,t){localStorage.setItem(e,JSON.stringify(t))}function f({children:e}){let[r,f]=(0,a.useState)(null),[w,b]=(0,a.useState)(null),[S,v]=(0,a.useState)([]),[q,C]=(0,a.useState)([]),[A,_]=(0,a.useState)(new Set);(0,a.useEffect)(()=>{b(g(u,null)),v(g(d,[])),C(g(c,[])),_(new Set(g(d+"_reveals",[])));let e=(0,l.createClient)();if(e){let t=(a,r=3)=>{e.from("profiles").select("*").eq("id",a).single().then(({data:e,error:n})=>{if(!n&&e){let t=i(e);f(t),h(s,t)}else r>0?setTimeout(()=>t(a,r-1),500):f(null)})};e.auth.getSession().then(({data:{session:e}})=>{e?.user&&t(e.user.id)});let{data:{subscription:a}}=e.auth.onAuthStateChange((e,a)=>{if(!a?.user){f(null),h(s,null);return}t(a.user.id)});return()=>a.unsubscribe()}f(g(s,null))},[]);let y=(0,a.useCallback)(e=>{f(e),h(s,e)},[]);(0,a.useCallback)(e=>{C(e),h(c,e)},[]);let k=(0,a.useCallback)(e=>{let t={answers:e,completed:!1};b(t),h(u,t)},[]),I=(0,a.useCallback)(()=>{b(e=>e?{...e,completed:!0}:null),h(u,{answers:g(u,{answers:[]}).answers,completed:!0})},[]),U=(0,a.useCallback)(async e=>{let t=(0,l.createClient)();if(t){var a;let{data:r,error:l}=await t.auth.signUp({email:e.email,password:e.password,options:{emailRedirectTo:`${window.location.origin}/auth/callback`}});if(l)return{error:{message:l.message}};let c=r.user?.id;if(!c)return{error:{message:"Sign up failed â€“ no user ID returned"}};let{password:m,...w}=e,b=g(u,{answers:[],completed:!1}),S={id:(a={...w,id:c,quizSnapshot:b.answers}).id,name:a.name,age:a.age,gender:a.gender,dating_preference:a.datingPreference??null,location:a.location,email:a.email,photo_url:a.photoUrl??null,photos:a.photos??null,quiz_snapshot:a.quizSnapshot??null},{error:q}=await t.from("profiles").insert(S);if(q)return{error:{message:`Profile creation failed: ${q.message}`}};let{data:C,error:A}=await t.from("profiles").select("*").eq("id",c).single();if(A||!C)return{error:{message:"Could not fetch created profile"}};let _=i(C);f(_),h(s,_);let y=p.map(e=>({...e,quizSnapshot:b.answers})).map(e=>{let t=n(b.answers||[],e.quizSnapshot||[]);return{id:"match-"+e.id,userId:e.id,profile:{id:e.id,name:e.name,age:e.age,photoUrl:e.photoUrl},compatibilityScore:t,compatibilitySummary:o(t),messageCount:0}});return v(y),h(d,y),{error:null}}let r=g(u,{answers:[],completed:!1});y({...e,id:"user-"+Date.now(),quizSnapshot:r.answers,createdAt:Date.now()});let c=p.map(e=>({...e,quizSnapshot:r.answers})).map(e=>{let t=n(r.answers||[],e.quizSnapshot||[]);return{id:"match-"+e.id,userId:e.id,profile:{id:e.id,name:e.name,age:e.age,photoUrl:e.photoUrl},compatibilityScore:t,compatibilitySummary:o(t),messageCount:0}});return v(c),h(d,c),{error:null}},[y]),D=(0,a.useCallback)(async(e,t)=>{let a=(0,l.createClient)();if(a){let{data:r,error:n}=await a.auth.signInWithPassword({email:e,password:t});if(n)return{error:{message:n.message}};if(!r.user)return{error:{message:"Sign in failed"}};let{data:o,error:l}=await a.from("profiles").select("*").eq("id",r.user.id).single();if(l||!o)return{error:{message:"Profile not found"}};let u=i(o);return f(u),h(s,u),v(g(d,[])),{error:null}}let r=g(s,null);return r&&r.email===e?(f(r),v(g(d,[])),{error:null}):{error:{message:"Invalid email or password"}}},[]),P=(0,a.useCallback)(()=>{let e=(0,l.createClient)();e&&e.auth.signOut(),y(null),v([]),C([]),_(new Set),h(d,[]),h(c,[]),h(d+"_reveals",[])},[y]),z=(0,a.useCallback)(()=>{v(g(d,[]))},[]),x=(0,a.useCallback)(e=>{let t=S.find(t=>t.id===e),a=r?[r.id,t?.userId??""]:[],n=q.find(t=>t.matchId===e);if(n)return n;let o=[...q,n={id:"conv-"+e+"-"+Date.now(),matchId:e,participantIds:a,messages:[],createdAt:Date.now()}];return C(o),h(c,o),n},[q,S,r]),T=(0,a.useCallback)((e,t)=>{if(!r)return;let a={id:"msg-"+Date.now(),conversationId:e,senderId:r.id,text:t,timestamp:Date.now()};C(t=>{let r=t.map(t=>t.id===e?{...t,messages:[...t.messages,a]}:t);return h(c,r),r}),v(t=>{let a=q.find(t=>t.id===e);if(!a)return t;let r=a.messages.length+1,n=t.map(e=>e.id===a.matchId?{...e,messageCount:r,lastMessageAt:Date.now()}:e);return h(d,n),n})},[r,q]),j=(0,a.useCallback)(e=>{let t=q.find(t=>t.matchId===e);return t?t.messages.length:0},[q]),M=(0,a.useCallback)(e=>{var t;let a=A.has(e),r=q.find(t=>t.matchId===e);return t=r?r.messages.length:0,a||t>=30?0:t>=15?40:t>=5?70:100},[q,A]),O=(0,a.useCallback)(e=>{_(t=>{let a=new Set(t);return a.add(e),h(d+"_reveals",[...a]),a})},[]),N=(0,a.useCallback)(async e=>{if(!r)return{error:{message:"Not signed in"}};let t=(0,l.createClient)();if(t){let{error:a}=await t.from("profiles").update({photos:e,photo_url:e[0]??null}).eq("id",r.id);if(a)return{error:{message:a.message}}}let a={...r,photos:e,photoUrl:e[0]??r.photoUrl};return f(a),h(s,a),{error:null}},[r]);return(0,t.jsx)(m.Provider,{value:{user:r,quiz:w,matches:S,conversations:q,setQuizAnswers:k,completeQuiz:I,signUp:U,signIn:D,signOut:P,updateUserPhotos:N,getOrCreateConversation:x,sendMessage:T,getMessageCount:j,getBlurForMatch:M,setMutualReveal:O,mutualReveals:A,refreshMatches:z},children:e})}function w(){let e=(0,a.useContext)(m);if(!e)throw Error("useApp must be used within AppProvider");return e}e.s(["AppProvider",()=>f,"useApp",()=>w],63371)},35885,e=>{"use strict";var t=e.i(43476),a=e.i(63371);function r({children:e}){return(0,t.jsx)(a.AppProvider,{children:e})}e.s(["AppProvider",()=>r])}]);